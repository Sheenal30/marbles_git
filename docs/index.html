<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Marble Betting Game</title>

  <!-- ‚ú® Fancy ‚Äúcasino‚Äù font -->
  <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">

  <!-- Main stylesheet -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="container">
    <h1>üé∞ Marble Betting Game</h1>

    <!-- ‚ù∂ SETUP SCREEN -->
    <section id="setup">
      <label>
        Starting gold:
        <input type="number" id="startGold" min="1" value="100" />
      </label>

      <label>
        Number of draws:
        <input type="number" id="draws" min="1" value="5" />
      </label>

      <button id="startBtn">Start Game</button>
    </section>

    <!-- ‚ù∑ BET SCREEN -->
    <section id="betting" class="hidden">
      <p id="status"></p>

      <label>
        Bet amount:
        <!-- ‚¨ÜÔ∏è step="50" makes ‚ñ≤‚ñº change by 50 -->
        <input type="number" id="bet" min="50" step="50" />
      </label>

      <button id="betBtn">Place Bet ‚èé</button>
      <button id="exitBtn" class="secondary">Exit Game</button>
    </section>

    <!-- ‚ù∏ GAME LOG -->
    <section id="log"></section>
  </div>

  <!-- ========= GAME LOGIC & EFFECTS ========= -->
  <script>
    /* --------------------------------------------------
       Basic data
    -------------------------------------------------- */
    const BAG = [
      ...Array(3).fill("red"),
      ...Array(5).fill("green"),
      "black",
      "white",
    ];
    const MULTIPLIERS = { green: 2, red: -1, black: 10, white: -5 };

    /* --------------------------------------------------
       DOM references
    -------------------------------------------------- */
    const $ = (id) => document.getElementById(id);
    const setupSection   = $("setup");
    const bettingSection = $("betting");
    const startBtn       = $("startBtn");
    const betBtn         = $("betBtn");
    const exitBtn        = $("exitBtn");
    const statusEl       = $("status");
    const logEl          = $("log");
    const betInput       = $("bet");

    /* --------------------------------------------------
       Game state
    -------------------------------------------------- */
    let goldStart, goldRemaining, drawsTotal, drawIndex = 0;

    /* --------------------------------------------------
       Helpers
    -------------------------------------------------- */
    const randomMarble = () => BAG[Math.floor(Math.random()*BAG.length)];
    const log = (msg, cssClass) => {
      logEl.innerHTML += `<p class="${cssClass}">${msg}</p>`;
      logEl.scrollTop = logEl.scrollHeight; // auto-scroll
    };

    /* Little utility to spawn many elements with animation */
    function spawnParticles(count, className){
      for(let i=0;i<count;i++){
        const el = document.createElement("div");
        el.className = className;
        el.style.left = Math.random()*100 + "vw";                // random x-pos
        el.style.animationDelay = Math.random()*0.5 + "s";       // slight spread
        document.body.appendChild(el);
        setTimeout(()=>el.remove(), 2000);                       // clean up
      }
    }

    /* --------------------------------------------------
       Event wiring
    -------------------------------------------------- */
    startBtn.onclick = () => {
      goldStart  = Number($("startGold").value);
      drawsTotal = Number($("draws").value);
      if(!goldStart || !drawsTotal) return alert("Enter valid numbers!");

      goldRemaining = goldStart;
      drawIndex     = 1;
      logEl.innerHTML = "";
      statusEl.textContent = `You start with ${goldRemaining} gold.`;

      setupSection.classList.add("hidden");
      bettingSection.classList.remove("hidden");
      betInput.focus();
    };

    betBtn.onclick = playRound;

    /* ‚èé ENTER also triggers Place Bet */
    betInput.addEventListener("keydown", e=>{
      if(e.key==="Enter") playRound();
    });

    exitBtn.onclick = endGame;

    /* --------------------------------------------------
       Main round function
    -------------------------------------------------- */
    function playRound(){
      const bet = Number(betInput.value);
      if(!bet || bet > goldRemaining || bet <= 0){
        return alert("Invalid bet amount.");
      }

      const drawn  = randomMarble();
      const result = bet * MULTIPLIERS[drawn];
      goldRemaining += result;

      /* Decide colours & particle effect ------------- */
      let cssClass, particleClass, particleCount;
      switch(drawn){
        case "green": cssClass="win-green";  particleClass="confetti"; particleCount=30; break;
        case "black": cssClass="win-black";  particleClass="confetti"; particleCount=80; break;
        case "red":   cssClass="lose-red";   particleClass="rain";     particleCount=20; break;
        case "white": cssClass="lose-white"; particleClass="rain";     particleCount=60; break;
      }
      spawnParticles(particleCount, particleClass);

      const outcome = result>0
        ? `won <strong>${result}</strong>`
        : `lost <strong>${-result}</strong>`;

      log(`Draw ${drawIndex}/${drawsTotal}: Marble is <em>${drawn}</em>. You ${outcome}. Gold left: ${goldRemaining}.`, cssClass);
      drawIndex++;

      /* End-game checks ----------------------------- */
      if(goldRemaining <= goldStart/2){
        statusEl.textContent = "üíÄ Less than half your gold remains. You lose!";
        endGame();
      }else if(drawIndex > drawsTotal){
        const diff = goldRemaining - goldStart;
        statusEl.textContent = diff>0
          ? `üéâ You finished up ${diff} gold!`
          : diff<0
            ? `üò¨ You finished down ${-diff} gold`
            : `üò∂ You broke even.`;
        endGame();
      }
      betInput.value="";
      betInput.focus();
    }

    function endGame(){
      bettingSection.classList.add("hidden");
      setupSection.classList.remove("hidden");
    }
  </script>
</body>
</html>
